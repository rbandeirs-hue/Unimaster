{% extends "base.html" %}
{% block title %}Meu Perfil – {{ aluno.nome }}{% endblock %}

{% block content %}
<div class="container mt-4">
    {% if alunos|length > 1 %}
    <div class="mb-3">
        <label class="form-label fw-semibold">Aluno:</label>
        <select class="form-select form-select-sm" style="max-width: 280px;" onchange="if(this.value) window.location.href='{{ url_for('painel_responsavel.meu_perfil') }}?aluno_id='+this.value">
            {% for a in alunos %}
            <option value="{{ a.id }}" {% if a.id == aluno.id %}selected{% endif %}>{{ a.nome }}</option>
            {% endfor %}
        </select>
    </div>
    {% endif %}

    <div class="mb-4">
        <h2 class="fw-bold text-primary">Meu Perfil</h2>
        <p class="text-muted mb-0">Informações do aluno — {{ aluno.nome }}</p>
    </div>

    <div class="row g-4">
        <!-- Coluna esquerda: Perfil do Aluno -->
        <div class="col-lg-4 col-md-5">
            <div class="card shadow-sm border-primary painel-perfil-card">
                <div class="card-body p-4">
                    <div class="perfil-card-content">
                        <div class="perfil-foto-wrap">
                            {% if aluno and aluno.foto %}
                            <img src="{{ url_for('static', filename='uploads/' + aluno.foto) }}" alt="Foto do aluno" class="perfil-foto">
                            {% else %}
                            <div class="perfil-foto-placeholder"><i class="bi bi-person-fill"></i></div>
                            {% endif %}
                        </div>
                        <h5 class="fw-bold text-center mb-3 mt-2">Perfil do aluno</h5>
                        <div class="perfil-dados">
                            <div class="perfil-item"><span class="perfil-label">Academia</span><span class="perfil-valor">{{ aluno.academia_nome or '—' }}</span></div>
                            <div class="perfil-item"><span class="perfil-label">Turma</span><span class="perfil-valor">{{ aluno.turma_nome or '—' }}</span></div>
                            <div class="perfil-item"><span class="perfil-label">Modalidades</span><span class="perfil-valor">{{ (aluno.modalidades or []) | join(', ') or '—' }}</span></div>
                            <div class="perfil-item"><span class="perfil-label">Faixa</span><span class="perfil-valor">{% if aluno.faixa_nome or aluno.graduacao_nome %}{{ aluno.faixa_nome or '' }}{% if aluno.faixa_nome and aluno.graduacao_nome %} ({{ aluno.graduacao_nome }}){% elif aluno.graduacao_nome %}{{ aluno.graduacao_nome }}{% endif %}{% else %}—{% endif %}</span></div>
                            <div class="perfil-item"><span class="perfil-label">Próxima faixa</span><span class="perfil-valor">{{ aluno.proxima_faixa|default('—') }}</span></div>
                        </div>
                        <div class="perfil-card-actions d-flex gap-2 mt-3 w-100 justify-content-center">
                            <a href="{{ url_for('alunos.editar_aluno', aluno_id=aluno.id, next=url_for('painel_responsavel.meu_perfil', aluno_id=aluno.id)) }}" class="btn btn-outline-warning btn-sm" title="Editar dados">
                                <i class="bi bi-pencil-fill"></i> Editar
                            </a>
                            <button type="button" class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#modalVerAluno" title="Ver dados completos">
                                <i class="bi bi-eye-fill"></i> Ver
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Coluna direita: atalhos -->
        <div class="col-lg-8 col-md-7">
            <div class="row g-2">
                <div class="col-sm-6 col-12">
                    <a href="{{ url_for('painel_responsavel.minhas_mensalidades', aluno_id=aluno.id) }}" class="text-decoration-none">
                        <div class="card shadow-sm border-success card-hover painel-atalho-card">
                            <div class="card-body text-center py-3 px-3 d-flex flex-column align-items-center">
                                <i class="bi bi-calendar-check fs-3 mb-2 text-success"></i>
                                <h6 class="fw-bold mb-1">Mensalidades</h6>
                                <p class="text-muted small mb-2">Vencimentos e pagamentos</p>
                                <span class="btn btn-success btn-sm px-3">Acessar</span>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="col-sm-6 col-12">
                    <a href="{{ url_for('painel_responsavel.minha_turma', aluno_id=aluno.id) }}" class="text-decoration-none">
                        <div class="card shadow-sm border-info card-hover painel-atalho-card">
                            <div class="card-body text-center py-3 px-3 d-flex flex-column align-items-center">
                                <i class="bi bi-collection fs-3 mb-2 text-info"></i>
                                <h6 class="fw-bold mb-1">Turma</h6>
                                <p class="text-muted small mb-2">Horários e informações</p>
                                <span class="btn btn-info btn-sm text-white px-3">Acessar</span>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="col-sm-6 col-12">
                    <a href="{{ url_for('painel_responsavel.minhas_presencas', aluno_id=aluno.id) }}" class="text-decoration-none">
                        <div class="card shadow-sm border-warning card-hover painel-atalho-card">
                            <div class="card-body text-center py-3 px-3 d-flex flex-column align-items-center">
                                <i class="bi bi-clipboard-check fs-3 mb-2 text-warning"></i>
                                <h6 class="fw-bold mb-1">Presenças</h6>
                                <p class="text-muted small mb-2">Histórico de presença</p>
                                <span class="btn btn-warning btn-sm text-dark px-3">Acessar</span>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="col-sm-6 col-12">
                    <a href="{{ url_for('painel_responsavel.curriculo', aluno_id=aluno.id) }}" class="text-decoration-none">
                        <div class="card shadow-sm border-secondary card-hover painel-atalho-card">
                            <div class="card-body text-center py-3 px-3 d-flex flex-column align-items-center">
                                <i class="bi bi-file-earmark-person fs-3 mb-2 text-secondary"></i>
                                <h6 class="fw-bold mb-1">Currículo</h6>
                                <p class="text-muted small mb-2">Competições e eventos</p>
                                <span class="btn btn-secondary btn-sm px-3">Acessar</span>
                            </div>
                        </div>
                    </a>
                </div>
                <div class="col-sm-6 col-12">
                    <a href="{{ url_for('painel_responsavel.associacao', aluno_id=aluno.id) }}" class="text-decoration-none">
                        <div class="card shadow-sm border-dark card-hover painel-atalho-card">
                            <div class="card-body text-center py-3 px-3 d-flex flex-column align-items-center">
                                <i class="bi bi-building fs-3 mb-2 text-dark"></i>
                                <h6 class="fw-bold mb-1">Associação</h6>
                                <p class="text-muted small mb-2">Academias vinculadas</p>
                                <span class="btn btn-dark btn-sm px-3">Acessar</span>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Ver dados do aluno -->
<div class="modal fade" id="modalVerAluno" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
    <div class="modal-content border-0 shadow-lg">
      <div class="modal-header">
        <h5 class="modal-title fw-bold"><i class="bi bi-person-badge me-2"></i>{{ aluno.nome }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="row g-3">
          <div class="col-12 col-md-6">
            <div class="modal-section-perfil">
              <h6><i class="bi bi-person-vcard"></i> Dados Pessoais</h6>
              <div class="modal-info-item"><span>Nascimento</span><strong>{{ aluno.data_nascimento|data_br if aluno.data_nascimento else '—' }}</strong></div>
              <div class="modal-info-item"><span>CPF</span><strong>{{ aluno.cpf or '—' }}</strong></div>
              <div class="modal-info-item"><span>Telefone</span><strong>{{ aluno.telefone_celular or aluno.telefone or '—' }}</strong></div>
              <div class="modal-info-item"><span>Email</span><strong>{{ aluno.email or '—' }}</strong></div>
              <div class="modal-info-item"><span>Responsável</span><strong>{{ aluno.responsavel_nome or aluno.responsavel or '—' }}</strong></div>
            </div>
          </div>
          <div class="col-12 col-md-6">
            <div class="modal-section-perfil">
              <h6><i class="bi bi-award"></i> Acadêmico</h6>
              <div class="modal-info-item"><span>Academia</span><strong>{{ aluno.academia_nome or '—' }}</strong></div>
              <div class="modal-info-item"><span>Turma</span><strong>{{ aluno.turma_nome or '—' }}</strong></div>
              <div class="modal-info-item"><span>Faixa</span><strong>{% if aluno.faixa_nome or aluno.graduacao_nome %}{{ aluno.faixa_nome or '' }}{% if aluno.faixa_nome and aluno.graduacao_nome %} ({{ aluno.graduacao_nome }}){% elif aluno.graduacao_nome %}{{ aluno.graduacao_nome }}{% endif %}{% else %}—{% endif %}</strong></div>
              <div class="modal-info-item"><span>Próxima faixa</span><strong>{{ aluno.proxima_faixa|default('—') }}</strong></div>
              <div class="modal-info-item"><span>Modalidades</span><strong>{{ (aluno.modalidades or []) | join(', ') or '—' }}</strong></div>
              {% if aluno.peso %}<div class="modal-info-item"><span>Peso</span><strong>{{ aluno.peso }} kg</strong></div>{% endif %}
            </div>
          </div>
          {% if aluno.observacoes %}
          <div class="col-12">
            <div class="modal-section-perfil">
              <h6><i class="bi bi-journal-text"></i> Observações</h6>
              <p class="mb-0 text-muted small">{{ aluno.observacoes }}</p>
            </div>
          </div>
          {% endif %}
        </div>
      </div>
      <div class="modal-footer border-0 bg-light">
        <a href="{{ url_for('alunos.editar_aluno', aluno_id=aluno.id, next=url_for('painel_responsavel.meu_perfil', aluno_id=aluno.id)) }}" class="btn btn-warning"><i class="bi bi-pencil me-1"></i> Editar</a>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>

<style>
.modal-section-perfil {
  border-radius: 12px;
  padding: 1rem 1.25rem;
  background: #f8f9fa;
  border: 1px solid #e9ecef;
  height: 100%;
}
.modal-section-perfil h6 {
  font-size: 0.8rem;
  font-weight: 700;
  color: #0d6efd;
  margin-bottom: 1rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid #dee2e6;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}
.modal-section-perfil .modal-info-item {
  display: grid;
  grid-template-columns: 1fr auto;
  align-items: center;
  gap: 1rem;
  font-size: 0.9rem;
  padding: 0.5rem 0;
  border-bottom: 1px solid #e9ecef;
}
.modal-section-perfil .modal-info-item:last-child { border-bottom: none; }
.modal-section-perfil .modal-info-item span { color: #6c757d; font-weight: 500; }
.modal-section-perfil .modal-info-item strong { color: #212529; text-align: right; word-break: break-word; }
.perfil-card-actions .btn { min-width: 90px; }
.perfil-card-content { display: flex; flex-direction: column; align-items: center; }
.painel-perfil-card { align-self: flex-start; }
.painel-atalho-card { transition: 0.2s ease; }
.card { border-radius: 0.75rem; transition: 0.2s ease; }
.card:hover, .card-hover:hover { transform: translateY(-5px); box-shadow: 0 0.6rem 1.2rem rgba(0,0,0,0.15) !important; }
.perfil-foto-wrap {
    width: 100px; height: 100px; border-radius: 50%; overflow: hidden;
    background: #e9ecef; display: flex; align-items: center; justify-content: center;
    border: 3px solid rgba(13, 110, 253, 0.3);
}
.perfil-foto { width: 100%; height: 100%; object-fit: cover; }
.perfil-foto-placeholder { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; color: #6c757d; }
.perfil-dados { width: 100%; }
.perfil-item { display: flex; justify-content: space-between; align-items: flex-start; gap: 0.75rem; padding: 0.35rem 0; border-bottom: 1px solid rgba(0,0,0,0.06); font-size: 0.875rem; }
.perfil-item:last-of-type { border-bottom: none; }
.perfil-label { font-weight: 600; color: #495057; flex-shrink: 0; }
.perfil-valor { color: #212529; text-align: right; word-break: break-word; }
</style>
{% endblock %}
