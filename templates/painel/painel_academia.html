  <!doctype html>
  <html lang="pt-br">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Judo Academy | Dashboard{% endblock %}</title>

    <!-- Fontes / Bootstrap / √çcones -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/base/layout.css') }}">

    {% block extra_css %}{% endblock %}
  </head>

  <body>

  {% if current_user.is_authenticated %}
    <!-- ====================================================== -->
    <!-- üîπ MENU LATERAL (RBAC) -->
    <!-- ====================================================== -->
    <div class="sidebar" id="sidebar" role="navigation">

      <div class="brand">
        <i class="bi bi-trophy-fill me-2"></i> <strong>Judo Academy</strong>
      </div>

      <nav class="nav flex-column mt-3">

        <!-- PAINEL -->
        <a class="nav-link {% if request.endpoint == 'painel.home' %}active{% endif %}"
          href="{{ url_for('painel.home') }}">
          <i class="bi bi-speedometer2"></i> Painel
        </a>

        <!-- FEDERA√á√ÉO -->
        {% if current_user.has_role('gestor_federacao') or current_user.has_role('admin') %}
        <a class="nav-link {% if request.endpoint == 'federacao.painel_federacao' %}active{% endif %}"
          href="{{ url_for('federacao.painel_federacao') }}">
          <i class="bi bi-diagram-3-fill"></i> Associa√ß√µes
        </a>
        {% endif %}

        <!-- ASSOCIA√á√ÉO -->
        {% if current_user.has_role('gestor_associacao') or current_user.has_role('admin') %}
        <a class="nav-link {% if request.endpoint == 'associacao.painel_associacao' %}active{% endif %}"
          href="{{ url_for('associacao.painel_associacao') }}">
          <i class="bi bi-people-fill"></i> Academias
        </a>
        {% endif %}

        <!-- ALUNOS -->
        {% if current_user.has_role('admin') or current_user.has_role('gestor_federacao')
              or current_user.has_role('gestor_associacao') or current_user.has_role('gestor_academia')
              or current_user.has_role('professor') %}
        <a class="nav-link {% if request.endpoint == 'alunos.lista_alunos' %}active{% endif %}"
          href="{{ url_for('alunos.lista_alunos') }}">
          <i class="bi bi-people-fill"></i> Alunos
        </a>
        {% endif %}

        <!-- ACADEMIA -->
        {% if current_user.has_role('gestor_academia') or current_user.has_role('professor') or current_user.has_role('admin') %}
        <a class="nav-link {% if request.endpoint == 'academia.painel_academia' %}active{% endif %}"
          href="{{ url_for('academia.painel_academia') }}">
          <i class="bi bi-person-lines-fill"></i> Cadastros
        </a>

        {% if current_user.has_role('gestor_academia') or current_user.has_role('admin') %}
        <a class="nav-link" href="#">
          <i class="bi bi-gear-wide-connected"></i> Gerenciamento
        </a>
        <a class="nav-link" href="#">
          <i class="bi bi-cash-coin"></i> Financeiro
        </a>
        <a class="nav-link" href="#">
          <i class="bi bi-sliders"></i> Configura√ß√µes
        </a>
        {% endif %}
        {% endif %}

        <!-- ALUNO -->
        {% if current_user.has_role('aluno') %}
        <a class="nav-link {% if request.endpoint == 'aluno.painel_aluno' %}active{% endif %}"
          href="{{ url_for('aluno.painel_aluno') }}">
          <i class="bi bi-person-badge-fill"></i> Meu Perfil
        </a>
        {% endif %}

      </nav>

      <!-- Logout -->
      <div class="logout mt-auto mb-3">
        <a class="nav-link text-danger fw-bold" href="{{ url_for('auth.logout') }}">
          <i class="bi bi-box-arrow-right"></i> Sair
        </a>
      </div>
    </div>
  {% endif %}

  <!-- ====================================================== -->
  <!-- üîπ CONTE√öDO PRINCIPAL -->
  <!-- ====================================================== -->
  <div class="main-content" id="main-content">

    {% if current_user.is_authenticated %}
    <div class="navbar-top">

      <button class="toggle-btn" id="sidebar-toggle" onclick="toggleSidebar()" 
              aria-label="Toggle navigation" aria-expanded="false">
        <i class="bi bi-list"></i>
      </button>

      <div class="user-info d-flex align-items-center ms-auto">

        <div class="text-end me-3">
          <h6 class="mb-0 text-dark fw-semibold">Bem-vindo, {{ current_user.nome }}</h6>
          <p class="mb-0 text-muted small">
            <i class="bi bi-person-badge me-1"></i>
            <strong class="text-primary">{{ current_user.roles|join(', ') }}</strong>
          </p>
        </div>

        <div class="profile-avatar">
          <i class="bi bi-person-circle fs-3 text-secondary"></i>
        </div>

      </div>
    </div>
    {% endif %}

    <!-- CONTAINER -->
    <div class="container-fluid mt-4">

      <!-- FLASH MESSAGES -->
      {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
          <div class="mb-4">
          {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="btn-close" data-bs-dismiss="alert"
                      aria-label="Fechar"></button>
            </div>
          {% endfor %}
          </div>
        {% endif %}
      {% endwith %}

      <!-- P√ÅGINA -->
      {% block content %}{% endblock %}

    </div>
  </div>


  <!-- ====================================================== -->
  <!-- üîπ SCRIPTS -->
  <!-- ====================================================== -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    function toggleSidebar() {
      const sidebar = document.getElementById('sidebar');
      const mainContent = document.getElementById('main-content');
      const toggleBtn = document.getElementById('sidebar-toggle');

      sidebar.classList.toggle('active');
      mainContent.classList.toggle('sidebar-active');

      toggleBtn.setAttribute('aria-expanded', sidebar.classList.contains('active'));
    }
  </script>

  {% block extra_js %}{% endblock %}
  </body>
  </html>
