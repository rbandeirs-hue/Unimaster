{% extends "base.html" %}
{% block title %}Gerenciar Categorias{% endblock %}
{% block content %}

<style>
    .table thead th {
        position: sticky;
        top: 0;
        background: #f8f9fa;
        z-index: 1;
    }

    .table td, .table th {
        vertical-align: middle;
    }

    .btn-editar-linha {
        min-width: 90px;
    }

    .textarea-notas {
        min-height: 60px;
        resize: vertical;
        white-space: pre-wrap;
    }

    @media (max-width: 768px) {
        .table-responsive {
            border: 0;
        }
        .table thead {
            display: none;
        }
        .table tbody tr {
            display: block;
            margin-bottom: 1rem;
            border: 1px solid #e9ecef;
            border-radius: .75rem;
            padding: .75rem;
            background: #fff;
        }
        .table tbody td {
            display: flex;
            justify-content: space-between;
            gap: .75rem;
            border: 0;
            padding: .35rem 0;
        }
        .table tbody td::before {
            content: attr(data-label);
            font-weight: 600;
            color: #6c757d;
            min-width: 120px;
        }
    }
</style>

<div class="container mt-4">
    <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-4">
        <div>
            <h2 class="fw-bold text-primary mb-1">Categorias</h2>
            <p class="text-muted mb-0">Classes por idade e categorias de peso.</p>
        </div>
        <div class="d-flex flex-wrap gap-2">
            <a href="{{ url_for('cadastros.categorias_classes') }}" class="btn btn-outline-primary btn-sm">
                <i class="bi bi-people-fill me-1"></i> Só Idades
            </a>
            <a href="{{ url_for('cadastros.categorias_pesos') }}" class="btn btn-outline-success btn-sm">
                <i class="bi bi-bar-chart-line-fill me-1"></i> Só Pesos
            </a>
            <a href="{{ url_for('cadastros.gerenciar_categorias') }}" class="btn btn-outline-dark btn-sm">
                <i class="bi bi-list-check me-1"></i> Todas
            </a>
            <a href="{{ url_for('painel.home') }}" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-arrow-left-circle me-1"></i> Voltar
            </a>
        </div>
    </div>

    <!-- ===================== CLASSES / IDADES ===================== -->
    {% if show_classes %}
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="bi bi-people-fill me-2"></i> Categorias por Idade</h5>
            <button type="submit" form="form-classes" class="btn btn-light btn-sm">
                <i class="bi bi-save2-fill me-1"></i> Salvar
            </button>
        </div>
        <div class="card-body">
            <form id="form-classes" method="POST">
                <input type="hidden" name="form_tipo" value="classes">
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Classe</th>
                                <th>Idade Mín</th>
                                <th>Idade Máx</th>
                                <th>Notas</th>
                                <th>Ação</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for c in classes %}
                            <tr data-editing="0">
                                <td data-label="ID">
                                    <input type="hidden" name="id_classe" value="{{ c.id_classe }}">
                                    <span class="fw-bold">{{ c.id_classe }}</span>
                                </td>
                                <td data-label="Classe">
                                    <input type="text" class="form-control" name="classe"
                                           value="{{ c.classe or '' }}" readonly>
                                </td>
                                <td data-label="Idade Mín">
                                    <input type="number" class="form-control" name="idade_min"
                                           value="{{ c.idade_min if c.idade_min is not none else '' }}" readonly>
                                </td>
                                <td data-label="Idade Máx">
                                    <input type="number" class="form-control" name="idade_max"
                                           value="{{ c.idade_max if c.idade_max is not none else '' }}" readonly>
                                </td>
                                <td data-label="Notas">
                                    <textarea class="form-control textarea-notas" name="notas" readonly>{{ c.notas or '' }}</textarea>
                                </td>
                                <td data-label="Ação">
                                    <button type="button" class="btn btn-outline-primary btn-sm btn-editar-linha">
                                        Editar
                                    </button>
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="6" class="text-muted text-center">Nenhuma classe encontrada.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </form>
        </div>
    </div>
    {% endif %}

    <!-- ===================== PESOS ===================== -->
    {% if show_pesos %}
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0"><i class="bi bi-bar-chart-line-fill me-2"></i> Categorias de Peso</h5>
            <button type="submit" form="form-pesos" class="btn btn-light btn-sm">
                <i class="bi bi-save2-fill me-1"></i> Salvar
            </button>
        </div>
        <div class="card-body">
            <form id="form-pesos" method="POST">
                <input type="hidden" name="form_tipo" value="pesos">
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Gênero</th>
                                <th>ID Classe</th>
                                <th>Categoria</th>
                                <th>Nome Categoria</th>
                                <th>Peso Mín</th>
                                <th>Peso Máx</th>
                                <th>Ação</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for p in pesos %}
                            <tr data-editing="0">
                                <td data-label="ID">
                                    <input type="hidden" name="id_peso" value="{{ p.id_peso }}">
                                    <span class="fw-bold">{{ p.id_peso }}</span>
                                </td>
                                <td data-label="Gênero">
                                    <input type="text" class="form-control" name="genero"
                                           value="{{ p.genero or '' }}" readonly>
                                </td>
                                <td data-label="ID Classe">
                                    <input type="text" class="form-control" name="id_classe_fk"
                                           value="{{ p.id_classe_fk or '' }}" readonly>
                                </td>
                                <td data-label="Categoria">
                                    <input type="text" class="form-control" name="categoria"
                                           value="{{ p.categoria or '' }}" readonly>
                                </td>
                                <td data-label="Nome Categoria">
                                    <input type="text" class="form-control" name="nome_categoria"
                                           value="{{ p.nome_categoria or '' }}" readonly>
                                </td>
                                <td data-label="Peso Mín">
                                    <input type="number" step="0.01" class="form-control" name="peso_min"
                                           value="{{ p.peso_min if p.peso_min is not none else '' }}" readonly>
                                </td>
                                <td data-label="Peso Máx">
                                    <input type="number" step="0.01" class="form-control" name="peso_max"
                                           value="{{ p.peso_max if p.peso_max is not none else '' }}" readonly>
                                </td>
                                <td data-label="Ação">
                                    <button type="button" class="btn btn-outline-primary btn-sm btn-editar-linha">
                                        Editar
                                    </button>
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="8" class="text-muted text-center">Nenhuma categoria de peso encontrada.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </form>
        </div>
    </div>
    {% endif %}
</div>

<script>
    document.querySelectorAll(".btn-editar-linha").forEach((btn) => {
        btn.addEventListener("click", () => {
            const row = btn.closest("tr");
            const editing = row.getAttribute("data-editing") === "1";
            const inputs = row.querySelectorAll("input, textarea");

            if (!editing) {
                inputs.forEach((el) => el.removeAttribute("readonly"));
                row.setAttribute("data-editing", "1");
                btn.textContent = "Pronto";
                btn.classList.remove("btn-outline-primary");
                btn.classList.add("btn-success");
            } else {
                inputs.forEach((el) => el.setAttribute("readonly", "readonly"));
                row.setAttribute("data-editing", "0");
                btn.textContent = "Editar";
                btn.classList.remove("btn-success");
                btn.classList.add("btn-outline-primary");
            }
        });
    });
</script>

{% endblock %}
